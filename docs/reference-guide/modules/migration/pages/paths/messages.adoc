= Message Migration
:navtitle: Messages

Axon Framework 5 introduces a more explicit way of defining and handling messages.
This path covers the message-model migration from Axon Framework 4.x annotations to the new message-centric approach in Axon Framework 5.

== Message-specific annotations

In Axon Framework 4, the type of a message was often implicitly determined by its class or by how it was dispatched. 
Axon Framework 5 introduces dedicated annotations to explicitly define the nature of your message objects.

The following table summarizes the primary annotation changes:

[cols="1,1,2"]
|===
| AF4 Annotation | AF5 Replacement | Reasoning

| `@TargetAggregateIdentifier`
| `@TargetEntityId`
| Axon Framework 5 moves from the "Aggregate" terminology towards a more general "Entity" model. This aligns with the Dynamic Consistency Boundary (DCB) principles where boundaries are more fluid. See the xref:migration:understanding-architecture-principles.adoc#moving-away-from-aggregates[architecture principles] for more details.

| `@Revision`
| `@Event(version = "...")`
| Consolidation of message metadata. The version is now part of the `MessageType`, which is a core concept in Axon Framework 5 for message identification and conversion.

| `@RoutingKey`
| `@Command(routingKey = "...")`
| Similar to revision, routing information is now consolidated within the `@Command` annotation, making the command's intent and behavior more explicit at the class level.
|===

== Explicit Message Types

One of the most significant changes in Axon Framework 5 is the introduction of `MessageType`. 
It decouples the logical name and version of a message from its Java class.

To embrace this, you should use the `@Command`, `@Event`, and `@Query` annotations on your message classes.

[source,java]
----
// AF4
@Revision("1.0")
public class MyEvent {
}

// AF5
@Event(name = "MyEvent", version = "1.0")
public class MyEvent {
}
----

By using these annotations, you provide Axon with the necessary information to resolve the `MessageType` without relying on fully qualified class names, which simplifies refactoring and cross-service communication.

If you don't specify the annotation parameters, Axon uses the following default behavior:

* **`namespace`**: Defaults to the **package name** of the message class.
* **`name`**: Defaults to the **simple class name**.
* **`version`**: Defaults to `0.0.1`.

For more details on how message types are resolved and used, see the xref:messaging-concepts:anatomy-message.adoc#message_type_resolution[Message type resolution] section in the Anatomy of a Message guide.

== Routing and Identification

=== Target Entity Identification

When sending a command to an entity (formerly aggregate), you previously used `@TargetAggregateIdentifier`. 
In Axon Framework 5, this is replaced by `@TargetEntityId`. This shift is part of the broader move towards Dynamic Consistency Boundaries. See the xref:migration:understanding-architecture-principles.adoc#moving-away-from-aggregates[architecture principles] for more context.

[source,java]
----
// AF4
public class MarkOrderAsShippedCommand {
    @TargetAggregateIdentifier
    private String orderId;
}

// AF5
public class MarkOrderAsShippedCommand {
    @TargetEntityId
    private String orderId;
}
----

=== Command Routing

For commands that require a specific routing key (e.g., for consistent hashing in a distributed command bus), the `@RoutingKey` annotation is replaced by the `routingKey` field in the `@Command` annotation.

[source,java]
----
// AF4
public class MyCommand {
    @RoutingKey
    private String someKey;
}

// AF5
@Command(routingKey = "someKey")
public class MyCommand {
    private String someKey;
}
----

Note that in Axon Framework 5, the `routingKey` property in the annotation refers to the **name of the property** (field or method) in the class that should be used for routing.
If a method name is provided, it can be the actual method name (e.g., `getCardId`) or the property name (e.g., `cardId`).
For more details, see the xref:commands:command-dispatchers.adoc#configuring-routing-keys-with-command[Configuring routing keys with @Command] section in the Command Dispatching guide.

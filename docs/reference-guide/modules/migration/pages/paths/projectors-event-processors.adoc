= Projectors and Event Processing Migration
:navtitle: Projectors and Event Processors

This path covers the migration of event processors and projection-related components (projectors) from Axon Framework 4.x to Axon Framework 5.

== Message Handler Annotation Changes

The annotations for handling events and queries have moved to new packages to align with the more explicit message-centric model of Axon Framework 5. For a detailed list of all import changes, refer to the xref:migration:paths/index.adoc#import-and-package-changes[Base import and package Changes] section.

== Removal of @ProcessingGroup

The `@ProcessingGroup` annotation has been removed in Axon Framework 5.
Previously, this annotation was used to group event handling components into a single event processor.

In Axon Framework 5, event handlers are registered directly to an event processor in the configuration.
A replacement for `@ProcessingGroup` in the form of a "namespace" annotation is expected to be introduced soon.

[source,java]
----
// AF4
@ProcessingGroup("my-processor")
public class MyProjector {
    @EventHandler
    public void on(MyEvent event) { /* ... */ }
}

// AF5 - Declarative registration (Non-Spring)
public void configure(MessagingConfigurer configurer) {
    configurer.eventProcessing()
              .registerPooledStreaming("my-processor", 
                  processingModule -> processingModule.eventHandlingComponents(
                      components -> components.autodetected(new MyProjector())
                  )
              );
}
----

== Event Processing Configuration

The way event processors are configured has changed significantly to provide a more modular and explicit API.

=== Non-Spring Users

For non-Spring users, the old `EventProcessingConfigurer` (and `EventProcessingModule`) has been replaced by a new flow accessed through the `MessagingConfigurer#eventProcessing` method.

[source,java]
----
// AF4
public void configure(Configurer configurer) {
    configurer.eventProcessing()
              .registerPooledStreamingEventProcessor("my-processor");
}

// AF5
public void configure(MessagingConfigurer configurer) {
    configurer.eventProcessing()
              .registerPooledStreaming("my-processor", module -> module.notCustomized());
}
----

=== Spring Users

For Spring users, the configuration of event processors has moved towards the **Event Processor Specification** (implemented via `EventProcessorSettings`).
This replaces the previous way of configuring processors through the `EventProcessingConfigurer` bean or complex property structures.

[source,yaml]
----
# AF5 Spring Boot properties example
axon:
  eventhandling:
    processors:
      my-processor:
        mode: pooled
        thread-count: 8
----

In code, you can customize these settings by providing `EventProcessorSettings` beans or using the `EventProcessorSettings.MapWrapper`.

== QueryUpdateEmitter as a Parameter

In Axon Framework 4, the `QueryUpdateEmitter` was often injected as a class-level field in projectors.
In Axon Framework 5, the use of `QueryUpdateEmitter` is enforced as a parameter of message handlers (specifically query handlers and event handlers that emit updates).

[source,java]
----
// AF4
public class MyProjector {
    @Autowired
    private QueryUpdateEmitter updateEmitter;

    @EventHandler
    public void on(MyEvent event) {
        updateEmitter.emit(MyQuery.class, q -> true, new MyView());
    }
}

// AF5
public class MyProjector {
    @EventHandler
    public void on(MyEvent event, QueryUpdateEmitter updateEmitter) {
        updateEmitter.emit(MyQuery.class, q -> true, new MyView());
    }
}
----

This change makes the dependency on the update emitter explicit for each handler and simplifies testing and component isolation.
